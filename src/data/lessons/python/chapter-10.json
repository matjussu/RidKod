{
  "chapterId": "py_ch_010",
  "title": "Gestion d'Erreurs",
  "subtitle": "Cr√©e des programmes robustes avec try, except et finally",
  "sections": [
    {
      "id": "section_1",
      "type": "text",
      "title": "Pourquoi g√©rer les erreurs ?",
      "content": "En Python, quand une erreur se produit, le programme **plante** (exception non g√©r√©e). La gestion d'erreurs permet de **pr√©voir** ces situations et de r√©agir intelligemment au lieu de crasher.\n\nC'est essentiel pour cr√©er des applications **robustes** et **professionnelles** !"
    },
    {
      "id": "section_2",
      "type": "code_example",
      "language": "python",
      "code": "# Sans gestion d'erreur : CRASH\nage = int(input(\"Ton √¢ge : \"))  # Si user tape \"abc\" ‚Üí ERREUR !\n\n# Avec gestion d'erreur : ROBUSTE\ntry:\n    age = int(input(\"Ton √¢ge : \"))\n    print(f\"Tu as {age} ans\")\nexcept ValueError:\n    print(\"Merci d'entrer un nombre valide\")",
      "caption": "Programme sans vs avec gestion d'erreur",
      "highlight": {
        "style": "info",
        "content": "üí° **Astuce** : Les blocs `try/except` permettent de **capturer** les erreurs et de les traiter au lieu de laisser le programme planter."
      }
    },
    {
      "id": "section_3",
      "type": "exercise",
      "exerciseId": "py_ch10_ex1"
    },
    {
      "id": "section_4",
      "type": "text",
      "title": "La structure try/except",
      "content": "La structure de base de la gestion d'erreurs :\n\n‚Ä¢ **`try:`** code qui pourrait g√©n√©rer une erreur\n‚Ä¢ **`except Type:`** code ex√©cut√© si l'erreur `Type` se produit\n\nSi aucune erreur : seul le `try` s'ex√©cute. Si erreur : on saute au `except`."
    },
    {
      "id": "section_5",
      "type": "code_example",
      "language": "python",
      "code": "try:\n    resultat = 10 / 0  # Division par z√©ro !\nexcept ZeroDivisionError:\n    print(\"Impossible de diviser par z√©ro\")\n    resultat = 0\n\nprint(f\"R√©sultat : {resultat}\")  # R√©sultat : 0",
      "caption": "G√©rer une division par z√©ro",
      "highlight": {
        "style": "success",
        "content": "‚úÖ **Cas d'usage r√©el** : Formulaires utilisateur, parsing de fichiers, requ√™tes r√©seau... Tout ce qui d√©pend d'entr√©es externes doit √™tre prot√©g√© par try/except."
      }
    },
    {
      "id": "section_6",
      "type": "exercise",
      "exerciseId": "py_ch10_ex2"
    },
    {
      "id": "section_7",
      "type": "text",
      "title": "Types d'erreurs courants",
      "content": "Python a de nombreux **types d'exceptions**. Voici les plus fr√©quents :\n\n‚Ä¢ **`ValueError`** : valeur incorrecte (ex: `int(\"abc\")`)\n‚Ä¢ **`ZeroDivisionError`** : division par z√©ro\n‚Ä¢ **`TypeError`** : op√©ration sur mauvais type\n‚Ä¢ **`KeyError`** : cl√© inexistante dans un dict\n‚Ä¢ **`IndexError`** : index hors limites\n‚Ä¢ **`FileNotFoundError`** : fichier introuvable"
    },
    {
      "id": "section_8",
      "type": "code_example",
      "language": "python",
      "code": "# ValueError\ntry:\n    x = int(\"abc\")\nexcept ValueError:\n    print(\"Conversion impossible\")\n\n# KeyError\ndata = {\"nom\": \"Alice\"}\ntry:\n    print(data[\"age\"])  # Cl√© inexistante\nexcept KeyError:\n    print(\"Cl√© non trouv√©e\")",
      "caption": "G√©rer diff√©rents types d'erreurs",
      "highlight": {
        "style": "warning",
        "content": "‚ö†Ô∏è **Attention** : Sp√©cifie toujours le type d'exception (`except ValueError:`). Un `except:` nu capte **tout** et peut masquer des bugs !"
      }
    },
    {
      "id": "section_9",
      "type": "text",
      "title": "Capturer plusieurs exceptions",
      "content": "Tu peux g√©rer **plusieurs types** d'erreurs diff√©remment avec plusieurs blocs `except`, ou les grouper dans un tuple :"
    },
    {
      "id": "section_10",
      "type": "code_example",
      "language": "python",
      "code": "# Plusieurs except s√©par√©s\ntry:\n    nombre = int(input(\"Nombre : \"))\n    resultat = 100 / nombre\nexcept ValueError:\n    print(\"Entr√©e invalide\")\nexcept ZeroDivisionError:\n    print(\"Division par z√©ro\")\n\n# Plusieurs exceptions dans un tuple\ntry:\n    # ... code\nexcept (ValueError, ZeroDivisionError) as e:\n    print(f\"Erreur : {e}\")",
      "caption": "G√©rer plusieurs types d'exceptions",
      "highlight": {
        "style": "info",
        "content": "üí° **Astuce** : Utilise `as e` pour capturer l'objet erreur et afficher son message d√©taill√©."
      }
    },
    {
      "id": "section_11",
      "type": "exercise",
      "exerciseId": "py_ch10_ex3"
    },
    {
      "id": "section_12",
      "type": "text",
      "title": "Le bloc else (optionnel)",
      "content": "Le bloc `else` s'ex√©cute **uniquement si aucune exception** n'a √©t√© lev√©e dans le `try`. Utile pour s√©parer le code normal du code de gestion d'erreur :"
    },
    {
      "id": "section_13",
      "type": "code_example",
      "language": "python",
      "code": "try:\n    fichier = open(\"data.txt\", \"r\")\nexcept FileNotFoundError:\n    print(\"Fichier introuvable\")\nelse:\n    print(\"Fichier ouvert avec succ√®s\")\n    contenu = fichier.read()\n    fichier.close()\n    print(contenu)",
      "caption": "Utiliser else pour le cas de succ√®s",
      "highlight": {
        "style": "success",
        "content": "‚úÖ **Bonne pratique** : Le `else` clarifie l'intention : \"Ce code ne doit s'ex√©cuter QUE si tout va bien\"."
      }
    },
    {
      "id": "section_14",
      "type": "text",
      "title": "Le bloc finally (nettoyage)",
      "content": "Le bloc `finally` s'ex√©cute **TOUJOURS**, qu'il y ait eu une erreur ou non. Parfait pour le **nettoyage** (fermer des fichiers, des connexions, etc.)."
    },
    {
      "id": "section_15",
      "type": "code_example",
      "language": "python",
      "code": "fichier = None\ntry:\n    fichier = open(\"config.txt\", \"r\")\n    contenu = fichier.read()\nexcept FileNotFoundError:\n    print(\"Fichier non trouv√©\")\nfinally:\n    if fichier:\n        fichier.close()\n    print(\"Nettoyage termin√©\")\n\n# Ce message s'affiche TOUJOURS (erreur ou pas)",
      "caption": "finally pour garantir le nettoyage",
      "highlight": {
        "style": "error",
        "content": "üö® **Pi√®ge courant** : Oublier de fermer un fichier peut causer des **fuites de ressources**. `finally` garantit que le nettoyage est fait."
      }
    },
    {
      "id": "section_16",
      "type": "exercise",
      "exerciseId": "py_ch10_ex4"
    },
    {
      "id": "section_17",
      "type": "text",
      "title": "Lever ses propres exceptions : raise",
      "content": "Tu peux **lever** (raise) tes propres exceptions avec le mot-cl√© `raise`. Utile pour valider des donn√©es et signaler des erreurs m√©tier :"
    },
    {
      "id": "section_18",
      "type": "code_example",
      "language": "python",
      "code": "def definir_age(age):\n    if age < 0:\n        raise ValueError(\"L'√¢ge ne peut pas √™tre n√©gatif\")\n    if age > 150:\n        raise ValueError(\"L'√¢ge semble irr√©aliste\")\n    return age\n\ntry:\n    mon_age = definir_age(-5)\nexcept ValueError as e:\n    print(f\"Erreur : {e}\")\n\n# Affiche : Erreur : L'√¢ge ne peut pas √™tre n√©gatif",
      "caption": "Lever des exceptions personnalis√©es",
      "highlight": {
        "style": "success",
        "content": "‚úÖ **Cas d'usage r√©el** : Dans une API, tu peux lever des exceptions pour signaler des donn√©es invalides (ex: email mal form√©, montant n√©gatif, etc.)."
      }
    },
    {
      "id": "section_19",
      "type": "exercise",
      "exerciseId": "py_ch10_ex5"
    },
    {
      "id": "section_20",
      "type": "text",
      "title": "R√©capitulatif",
      "content": "üéØ **Ce que tu as appris :**\n\n‚Ä¢ Structure `try/except` pour capturer les erreurs\n‚Ä¢ Types d'exceptions courants (`ValueError`, `ZeroDivisionError`, `KeyError`...)\n‚Ä¢ G√©rer plusieurs exceptions avec plusieurs `except`\n‚Ä¢ Bloc `else` pour le code de succ√®s\n‚Ä¢ Bloc `finally` pour le nettoyage garanti\n‚Ä¢ Lever ses propres exceptions avec `raise`\n\n**F√©licitations !** Tu as termin√© le parcours Python d√©butant. Tu es maintenant capable de lire et comprendre du code Python professionnel ! üéâ"
    }
  ],
  "exercises": [
    {
      "id": "py_ch10_ex1",
      "type": "predict_output",
      "inputType": "options",
      "question": "Que va afficher ce code si l'utilisateur tape \"abc\" ?",
      "code": "try:\n    nombre = int(input())  # User tape \"abc\"\n    print(\"OK\")\nexcept ValueError:\n    print(\"Erreur\")",
      "options": ["OK", "Erreur", "abc", "Le programme plante"],
      "correctAnswer": 1,
      "explanation": "`int(\"abc\")` l√®ve une `ValueError`. Le code saute au bloc `except` et affiche **Erreur**.",
      "highlightedLines": [2, 4, 5],
      "xpGain": 10
    },
    {
      "id": "py_ch10_ex2",
      "type": "find_error",
      "inputType": "clickable_lines",
      "question": "Ce code devrait g√©rer la division par z√©ro, mais il plante. Quelle ligne contient l'erreur ?",
      "code": "try:\n    resultat = 10 / 0\nexcept ValueError:\n    print(\"Division impossible\")",
      "correctAnswer": 2,
      "explanation": "Ligne 3 : Une division par z√©ro l√®ve une **ZeroDivisionError**, pas une `ValueError`. Il faut √©crire `except ZeroDivisionError:`.",
      "highlightedLines": [3],
      "xpGain": 10
    },
    {
      "id": "py_ch10_ex3",
      "type": "predict_output",
      "inputType": "options",
      "question": "Que va afficher ce programme ?",
      "code": "try:\n    liste = [1, 2, 3]\n    print(liste[5])\nexcept IndexError:\n    print(\"Index invalide\")\nexcept ValueError:\n    print(\"Valeur invalide\")",
      "options": ["Index invalide", "Valeur invalide", "5", "Le programme plante"],
      "correctAnswer": 0,
      "explanation": "Acc√©der √† `liste[5]` sur une liste de 3 √©l√©ments l√®ve une **IndexError**. Le premier `except` correspondant est ex√©cut√© : **Index invalide**.",
      "highlightedLines": [3, 4, 5],
      "xpGain": 10
    },
    {
      "id": "py_ch10_ex4",
      "type": "predict_output",
      "inputType": "options",
      "question": "Le bloc finally s'ex√©cute-t-il dans ce cas ?",
      "code": "try:\n    x = 10 / 2\nexcept ZeroDivisionError:\n    print(\"Erreur\")\nfinally:\n    print(\"Nettoyage\")",
      "options": ["Oui", "Non", "Seulement si erreur", "Seulement sans erreur"],
      "correctAnswer": 0,
      "explanation": "Le bloc `finally` s'ex√©cute **TOUJOURS**, qu'il y ait erreur ou non. Ici, aucune erreur, mais \"Nettoyage\" est quand m√™me affich√©.",
      "highlightedLines": [5, 6],
      "xpGain": 10
    },
    {
      "id": "py_ch10_ex5",
      "type": "concept_understanding",
      "inputType": "options",
      "question": "Que fait le mot-cl√© raise ?",
      "code": "def verifier(x):\n    if x < 0:\n        raise ValueError(\"N√©gatif interdit\")\n    return x",
      "options": ["Capture une erreur", "L√®ve une exception", "Affiche un message", "Retourne une valeur"],
      "correctAnswer": 1,
      "explanation": "`raise` **l√®ve** (d√©clenche) une exception. Ici, si `x < 0`, on l√®ve une `ValueError` avec un message personnalis√©.",
      "highlightedLines": [3],
      "xpGain": 10
    }
  ]
}
